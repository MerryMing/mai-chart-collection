# 抄谱流程

## 使用工具

[Visual Maimai](https://www.bilibili.com/video/BV1zLtveZEKP): 太好用了你们知道吗? 鼠标点点就能抄谱,抄得又快又好!

[Majdata](https://github.com/TeamMajdata/MajdataView): 核验谱面 Note 数量, 以及 Visual Mai 做不到的它来做

[MaiChartConverter](https://github.com/Neskol/MaichartConverter): 用于转换 maidata 到 ma2 文件

[MaiChartManager](https://github.com/MuNET-OSS/MaiChartManager): 用于提取音频, 整理谱面, 以及更方便地编辑 XML 文件

## 具体流程

### 1. 收集整理谱面确认视频

参考这里的[谱面来源](./信息来源.md) Public 一栏, 下载所需要的视频文件.

至于怎么下载, 那就是八仙过海各显神通的时刻了.

本人使用的是 [Bilibili-Evolved](https://github.com/the1812/Bilibili-Evolved) 脚本下载B站视频, 使用  [Parabolic](https://github.com/NickvisionApps/Parabolic) 软件下载的 YouTube 视频, 这个根据自己的喜好来, 总之先拉下来视频先.

然后使用准备好的音源, 不管是用音乐软件/视频平台直接下载再剪辑成游戏版本, 还是从 Publeak 渠道翻找资源文件导出的音频都可以.

之后使用视频剪辑软件, 把音频和视频对齐. 我这里使用的是 Adobe Premiere Pro.

![premiere序列](/assets/premiere%20序列预览.png)

对齐音频和视频的波形图, 直接导出就好. 如果波形图对不齐, 我偏向于让视频比音源更慢一些 (也就慢1帧), 在之后抄谱的时候能够看到 note 不会错过.

序列设置 1080P 60帧, 导出时不需要音频, 码率尽量设置的高一些, 我使用 6Mbps 码率 VBR , 这样在之后抄谱的时候, 预览视频不会缺帧.

视频导出到 maidata.txt 同一个文件夹, 重命名为 pv.mp4

### 2. 使用 Visual Maimai 抄谱

用这个工具的原因是来自于群里的一句话:

> *这样, 你在油管找谱面确认视频, 下载后用vm抄, 鼠标点两下就好了*
>
> *—— AquaDX交流群某位管理员*

在这之前我试过用 Majdata 抄谱, 且不说抽象的 Simai 语法, 调 `{}` 分音不知道输入了多少个逗号, 导致在对音上面不知道浪费多少时间. 单单是 PV 对不齐谱面确认的边框这一点, 就被 VM 秒杀.

我体会过照着视频抄一个 13+ 谱面抄了3个小时还抄错一堆, 也经历过为了找缺了/多了一个 Note 费了半个小时. 当别人这句话发出来后感觉自己醍醐灌顶, 捡起了快一年没打开的 VM , 再去抄谱真的好爽.

![Visual Maimai 预览界面](/assets/visual%20maimai%20预览.png)

谱面确认视频和 VM 谱面预览界面对齐,可以说是严丝合缝. 有时候视频 Note 和预览 Note 有一些错位, 正好也能在复查的时候观察到 Note 是不是抄错/有没有带套/是不是break. 只有个别分音调整的时候会影响, 但也能靠听音源/用鼠标滚轮观察 Note 变化速度确认正确的分音.

即使抛开 PV 这点不谈, 相比于 Majdata, VM 使用鼠标滚轮轻松定位, 单击即可插入 Note, 还可以实时和谱面确认视频比较看自己有没有抄错. 体验比 Majdata 好到不知道哪里去了.

再加上可以用鼠标快速选择Note, 使用快捷键复制粘贴/旋转翻转 Note 也是实时显示的, 对于有大量重复note排列的绿/黄谱简直就是节省生命的救星. 抄一张绿谱时间压缩到5分钟左右, 加上审核时间也不过10分钟, 这样才有意愿去抄绿黄谱.

一些抄谱心得:

- 建议抄红谱/紫谱默认分音是8, 绿黄谱分音默认是4.

- 绿黄谱有许多重复的地方. 长的4个小节会循环一次, 短的部分2个小节循环. 甚至循环的开头会用break标记. 一般重复段落会用镜像排列区分. 但也要注意最后一个小节有没有多/少/变note

- 最常用的星星时值是[8:1].

VM 谱面文件默认是自有的 JSON 格式, 但是它自带 Maidata 转换器, 可以轻松复制到 Majdata 内保存.

在 Majdata 修改谱面定数, 谱师, 标题, 以及手动修改一些特别密集的分音.

### 3. 转换成 ma2 谱面文件

转单张谱面一般用 MaiChartConverter 手敲命令, 以后要考虑用 AI 攒个 GUI 界面.

```pwsh
.\MaiChartConverter.exe `
  -p maidata.txt `
  -d 5 `
  -f Ma2_104 `
  -o 0xxxxx_03.ma2
```

绿黄谱记得替换 `M1` 到 `L1`, 把 TOUCH 的尺寸改大.

如果编写好全难度的 maidata 直接用 MaiChartManager 导入就好, 速度快, 能自动编写 xml.

但是 MCM 缺一些 xml 字段, 比如宴谱相关字段 (但是一般谱面又调用不到, 不写也没关系?). 所以在 main 仓库写了个 xml 模板, 每次都需要手动核实一些标签.

- `<name>` 歌曲ID应该是最好找的, 翻 `events` 和 `mapBonusMusic` 能找到所有歌曲的 ID 和曲名. 不得不吐槽铸币立本人为什么要把所有更新计划都打包在初日...

- `<netOpenName>` 记录每次更新日期

- `<version>` 记录更新次数, 一般按照官方发的动态, 更一次就+1.

- `<rightsInfoName>` 的 ID 需要翻 `AssetBundleImage/rights` 目录, 结合玩家出勤的视频找到对应的版权标, 才能填写正确的 ID.

- `<artistName>` `<noteDesigner>` 这类 ID 标签在 A000 里搜有没有出现过的, 如果没有统一标 999.

有很多字段翻A000都能填出来, 反正已经准备好所有歌曲的 xml 了.

宴谱相关的字段我也没搞清楚, 还是在群里等大佬教吧.

## 最后的碎碎念

也是一时兴起才决定抄谱的, 发现抄谱是个磨时间的工作, 不知道能够持续多长时间

在下个版本的 app 文件 publeak 的那一刻, 这个仓库就没有任何存在价值. 对于大手子来说

但是能在这个过程中学到些什么东西, 或者能帮到别人, 就足够了. 起码对于我这种不写代码的人来说, 有个愿意投入精力的 git 项目也是一个不错的实践.